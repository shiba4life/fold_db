# [8-2] Implement Ed25519 key generation utilities

[Back to task list](./tasks.md)

## Description

Implement secure Ed25519 key generation utilities for DataFold's database master key encryption system. This includes creating a cryptographic module with functions for generating, serializing, and managing Ed25519 key pairs using the researched ed25519-dalek APIs.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2024-12-30 13:45:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2024-12-30 13:46:00 | Status Update | Proposed | Agreed | Task approved for implementation | tomtang |
| 2024-12-30 13:47:00 | Status Update | Agreed | InProgress | Started implementation work | AI Agent |
| 2024-12-30 14:15:00 | Status Update | InProgress | Review | Completed Ed25519 key generation utilities implementation | AI Agent |

## Requirements

1. **Key Generation Module**: Create a dedicated module for Ed25519 cryptographic operations
2. **Secure Key Generation**: Implement functions to generate cryptographically secure Ed25519 key pairs
3. **Serialization Support**: Provide conversion to/from bytes for storage and transmission
4. **Error Handling**: Implement comprehensive error handling for cryptographic operations
5. **Security Best Practices**: Follow secure coding practices from the research guides
6. **Integration Ready**: Prepare interfaces for integration with database initialization

## Implementation Plan

1. **Create Crypto Module Structure**:
   - Create `src/crypto/mod.rs` module
   - Create `src/crypto/ed25519.rs` for Ed25519 operations
   - Add necessary dependencies to Cargo.toml

2. **Implement Key Generation**:
   - Generate secure Ed25519 signing keys using OsRng
   - Extract verifying (public) keys from signing keys
   - Implement key pair structure for database use

3. **Add Serialization Support**:
   - Convert keys to/from byte arrays for storage
   - Implement safe error handling for deserialization
   - Add support for different serialization formats

4. **Error Handling and Types**:
   - Define custom error types for crypto operations
   - Implement proper error propagation
   - Add validation for key material

5. **Testing and Validation**:
   - Unit tests for key generation round-trips
   - Test serialization/deserialization 
   - Verify cryptographic properties

## Test Plan

**Objective**: Verify that Ed25519 key generation utilities work correctly and securely.

**Test Scope**: Key generation, serialization, error handling, and security properties.

**Key Test Scenarios**:
- Key generation produces valid Ed25519 keys
- Public keys can be extracted from signing keys
- Serialization round-trips preserve key validity
- Error cases are handled gracefully
- Keys can sign and verify data correctly

**Success Criteria**:
- All key generation functions produce cryptographically valid keys
- Serialization/deserialization is lossless and error-safe
- Error handling covers all failure modes
- Integration interfaces are ready for database module use
- All tests pass including property-based tests

## Verification

- [x] Crypto module structure created with proper organization
- [x] Ed25519 key generation functions implemented
- [x] Signing key and verifying key types defined
- [x] Serialization to/from bytes implemented
- [x] Comprehensive error handling added
- [x] Unit tests cover all key operations
- [x] Integration interfaces defined for database use
- [x] Security best practices followed throughout

## Files Modified

**New Files**:
- `src/crypto/mod.rs` - Main crypto module definition
- `src/crypto/ed25519.rs` - Ed25519 key generation and management
- `src/crypto/error.rs` - Crypto-specific error types

**Modified Files**:
- `Cargo.toml` - Add ed25519-dalek, rand, and zeroize dependencies
- `src/lib.rs` - Export crypto module 