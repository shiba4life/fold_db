# Task 33-5: Migrate existing cryptographic logic to unified module

**Status**: InProgress  
**Assigned to**: Code Mode  
**Estimated effort**: 4-6 hours  
**Created**: 2025-06-19T17:02:30Z  
**Updated**: 2025-06-19T17:02:30Z  

## Summary

Migrate existing cryptographic logic from the fragmented modules to use the new unified cryptographic module, ensuring all functionality is preserved during the transition.

## Context

Following the completion of:
- Task 33-1: Cryptographic module analysis (Review)
- Task 33-2: Unified architecture design (Review)  
- Task 33-3: Core primitives layer implementation (Review)
- Task 33-4: Operational layer implementation (Review)

This task implements the migration of existing cryptographic logic to use the unified module interfaces.

## Acceptance Criteria

- [ ] **Migration Phase 1**: Database encryption operations migrated to unified module
  - [ ] `src/db_operations/encrypted_backup.rs` migrated to use unified backup operations
  - [ ] `src/db_operations/encryption_wrapper.rs` migrated to use unified database operations
  - [ ] `src/db_operations/crypto_metadata.rs` migrated to use unified key management

- [ ] **Migration Phase 2**: CLI cryptographic commands migrated to operational layer
  - [ ] `src/cli/crypto_commands.rs` migrated to use unified CLI operations
  - [ ] CLI command handlers updated to use operational layer

- [ ] **Migration Phase 3**: Configuration modules migrated to unified crypto config
  - [ ] `src/config/crypto.rs` integrated with unified configuration
  - [ ] Configuration loading updated to use `UnifiedCryptoConfig`

- [ ] **Migration Phase 4**: Network cryptographic operations migrated
  - [ ] `src/network/key_propagation.rs` migrated to unified network operations
  - [ ] Network crypto components integrated with unified module

- [ ] **Migration Phase 5**: Verification and authentication modules migrated
  - [ ] `src/cli/verification/` modules migrated to unified authentication
  - [ ] Authentication patterns updated to use unified auth operations

- [ ] **Migration Phase 6**: Import statements and dependencies updated
  - [ ] All import statements updated to reference unified module
  - [ ] Dependency graph cleaned up and validated
  - [ ] Legacy crypto imports removed

- [ ] **Backward Compatibility Maintained**:
  - [ ] Existing public APIs preserved during migration
  - [ ] Adapter layers created where necessary for seamless transition
  - [ ] All existing tests continue to pass
  - [ ] Migration tests added to verify equivalent functionality

- [ ] **Security Validation**:
  - [ ] No security regressions during migration
  - [ ] All cryptographic operations maintain security properties
  - [ ] Audit logging continues to function properly
  - [ ] Key rotation and lifecycle management functionality tested

## Technical Implementation

### Primary Migration Targets

1. **Database Operations**:
   - `src/db_operations/encrypted_backup.rs` → [`src/unified_crypto/backup.rs`](../../../src/unified_crypto/backup.rs)
   - `src/db_operations/encryption_wrapper.rs` → [`src/unified_crypto/database.rs`](../../../src/unified_crypto/database.rs)
   - `src/db_operations/crypto_metadata.rs` → [`src/unified_crypto/keys.rs`](../../../src/unified_crypto/keys.rs)

2. **CLI Operations**:
   - `src/cli/crypto_commands.rs` → [`src/unified_crypto/cli.rs`](../../../src/unified_crypto/cli.rs)
   - CLI handlers updated to use [`UnifiedCryptoManager`](../../../src/unified_crypto/mod.rs)

3. **Configuration**:
   - `src/config/crypto.rs` → [`src/unified_crypto/config.rs`](../../../src/unified_crypto/config.rs)
   - Config loading updated to use unified patterns

4. **Network Operations**:
   - `src/network/key_propagation.rs` → [`src/unified_crypto/network.rs`](../../../src/unified_crypto/network.rs)

5. **Authentication**:
   - `src/cli/verification/` → [`src/unified_crypto/auth.rs`](../../../src/unified_crypto/auth.rs)

### Migration Strategy

1. **Preserve APIs**: Maintain existing public interfaces during migration
2. **Adapter Pattern**: Create adapters for seamless transition where needed
3. **Incremental Migration**: Migrate modules one at a time with testing
4. **Security Focus**: Ensure no security regressions during transition
5. **Test Coverage**: Maintain comprehensive test coverage throughout migration

## Dependencies

- **Depends on**: Task 33-4 (Operational layer implementation - Review)
- **Blocks**: Task 33-6 (Remove legacy modules)

## Definition of Done

- All existing cryptographic modules successfully migrated to unified module
- All functionality preserved with no regressions
- Comprehensive test coverage maintained and enhanced
- Security audit logging continues to function properly
- Migration tests validate equivalent functionality
- Documentation updated to reflect unified module usage
- Code review completed and approved