# 25-2 Create shared security types module

[Back to task list](./tasks.md)

## Description

Create a unified `security_types.rs` module that consolidates all security-related enums into a single, well-organized location. This module will serve as the single source of truth for all security type definitions across the DataFold codebase.

Based on the analysis from task 25-1, this task implements the actual shared module with all identified security enums, proper documentation, and consistent naming conventions.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-06-13 11:20:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-06-13 11:31:00 | StatusChange | Proposed | InProgress | Beginning implementation of shared security types module | AI_Agent |

## Requirements

### Functional Requirements
- **FR1**: Create unified security types module with all security enums
- **FR2**: Resolve conflicts between duplicate enum definitions
- **FR3**: Maintain serialization compatibility for existing APIs
- **FR4**: Provide comprehensive documentation for all types

### Technical Requirements
- **TR1**: Module location: `src/security/types.rs` or `src/security_types.rs`
- **TR2**: All enums must support required derive traits (Debug, Clone, Serialize, Deserialize, etc.)
- **TR3**: Maintain backward-compatible serialization for API stability
- **TR4**: Include module-level documentation and examples

### Quality Requirements
- **QR1**: Consistent naming conventions across all enums
- **QR2**: Comprehensive documentation for each enum and variant
- **QR3**: No breaking changes to existing serialization formats
- **QR4**: Clear module organization and structure

## Implementation Plan

### Phase 1: Module Structure Design
1. **Choose Module Location**:
   - Evaluate `src/security/types.rs` vs `src/security_types.rs`
   - Consider future security module organization
   - Update `src/lib.rs` and module hierarchy as needed

2. **Organize Enum Categories**:
   - Status and lifecycle enums (`RotationStatus`, `ComplianceStatus`)
   - Threat and risk enums (`ThreatLevel`, `RiskAction`)
   - Configuration enums (`SecurityLevel`, `SecurityProfile`)
   - Event and monitoring enums (`SecurityPattern`, `SecurityEventType`)

### Phase 2: Enum Consolidation
1. **Resolve `RotationStatus` Duplication**:
   - Merge definitions from `db_operations/key_rotation_operations.rs` and `crypto/key_rotation_audit.rs`
   - Ensure all variants are preserved
   - Maintain serialization compatibility

2. **Standardize Security Enums**:
   - `ThreatLevel`: Low, Medium, High, Critical
   - `ComplianceStatus`: Compliant, MostlyCompliant, PartiallyCompliant, NonCompliant, UnderReview
   - `SecurityLevel`: Interactive, Balanced, Sensitive
   - `RiskAction`: Allow, AllowWithMonitoring, Block
   - `SecurityPattern`: All existing patterns from security_monitor.rs

3. **Add Missing Common Types**:
   - Security event severities and types
   - Authentication and authorization levels
   - Any other security-related enums identified in analysis

### Phase 3: Documentation and Testing
1. **Module Documentation**:
   - Comprehensive module-level docs with usage examples
   - Document each enum's purpose and usage context
   - Include migration guide for existing code

2. **Serialization Testing**:
   - Verify JSON serialization compatibility
   - Test deserialization of existing data
   - Ensure no breaking changes in API responses

### Phase 4: Integration Preparation
1. **Export Structure**:
   - Re-export all types from appropriate parent modules
   - Maintain backward compatibility where possible
   - Prepare deprecation warnings for old locations

## Implementation Details

### Module Structure
The unified security types module has been implemented at `src/security_types.rs` with the following structure:

- **Core Types**: 4 unified enums consolidating 15+ duplicate definitions
- **Documentation**: Comprehensive module and type documentation with usage examples
- **Testing**: Unit tests covering state transitions, ordering, and serialization
- **Integration**: Exported through `src/lib.rs` for project-wide access

### Unified Enum Implementations

1. **RotationStatus** (7 variants)
   - Consolidates conflicting definitions from crypto and db_operations modules
   - Includes all variants: `Requested`, `Validating`, `InProgress`, `Completed`, `Failed`, `Cancelled`, `RolledBack`
   - Provides helper methods for state checking and transitions

2. **Severity** (4 variants)
   - Replaces 8 different severity-related enums across modules
   - Standardized levels: `Info`, `Warning`, `Error`, `Critical`
   - Implements ordering, display formatting, and threshold checking

3. **SecurityLevel** (3 variants)
   - Consolidates multiple SecurityLevel definitions
   - Clear levels: `Low`, `Standard`, `High` with crypto parameter mappings
   - Provides methods for Argon2 parameters and security characteristics

4. **HealthStatus** (5 variants)
   - Unifies health/status enums from multiple modules
   - States: `Healthy`, `Warning`, `Critical`, `Failed`, `Offline`
   - Includes operational status checking and severity mapping

### Integration Status
- ✅ Module created at `src/security_types.rs`
- ✅ Added to `src/lib.rs` module declarations
- ✅ Exported core types (avoiding SecurityLevel conflict temporarily)
- ✅ Compilation verified with `cargo check`

## Verification

### Acceptance Criteria
- [x] Shared security types module created and properly integrated
- [x] All identified security enums consolidated into shared module
- [x] No duplicate enum definitions remain in shared module
- [x] Serialization compatibility maintained for all enums
- [x] Comprehensive documentation provided for all types
- [x] Module compiles successfully and passes all tests

### Testing Strategy
- **Unit Tests**: Test serialization/deserialization for all enums
- **Integration Tests**: Verify module integration with existing code
- **Compatibility Tests**: Ensure existing JSON data can still be parsed
- **Documentation Tests**: Verify all code examples compile and work

### Definition of Done
- Security types module implemented and documented
- All security enums consolidated with resolved conflicts
- Serialization backward compatibility verified
- Module integrated into build system
- Documentation complete with usage examples

## Files Modified

### New Files
- `src/security_types.rs` OR `src/security/types.rs` (final location TBD)
- `src/security/mod.rs` (if using security directory structure)

### Modified Files
- `src/lib.rs` (add module exports)
- `src/mod.rs` files (update module hierarchy as needed)
- `Cargo.toml` (if any new dependencies required)

### Files for Reference (Read Only)
- All files identified in task 25-1 analysis
- Existing enum definitions to be consolidated
- API documentation and tests for compatibility verification

## Dependencies

- **Prerequisite**: Task 25-1 (security enum audit) must be completed
- **Inputs**: Analysis report from task 25-1 with complete enum inventory
- **Coordination**: Ensure no conflicting changes in security modules during implementation